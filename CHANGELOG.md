# 更新日志

## [3.7.0] - 2025-10-08

### 新增

- **OCR多配置管理系统**:
  - 支持创建和管理多个OCR API配置（OpenAI-Compatible, Mistral API等）
  - 提供直观的配置管理界面，支持配置的增删改查
  - 实现配置验证和API连接测试功能
  - 支持配置导入导出，便于配置备份和分享
  - 提供自动备份机制，保留最近10个配置版本
  - 实现从旧版.env配置文件的自动迁移

- **OCR配置切换功能**:
  - 支持快速切换不同的API配置
  - 提供默认配置设置功能
  - 在主界面显示当前使用的配置信息

### 优化

- **代码架构**:
  - 重构配置管理逻辑，采用模块化设计
  - 实现配置数据模型和管理器的分离
  - 优化API调用接口，提高代码可维护性

- **用户体验**:
  - 改进OCR配置界面，提供更直观的操作体验
  - 添加配置状态和验证反馈
  - 优化配置切换流程

### 技术改进

- **数据模型**:
  - 使用Python数据类实现配置数据模型
  - 实现配置验证机制，确保数据完整性
  - 支持JSON格式的配置存储和传输

- **安全增强**:
  - 改进API密钥的安全存储机制
  - 添加配置文件访问权限控制
  - 实现配置验证和测试机制

## [3.6.2] - 2025-09-12

### 新增

- **OCR拖拽支持图片文件**:
  - OCR标签页现在支持直接拖拽图片文件进行OCR识别
  - 支持的图片格式：JPG、JPEG、PNG、BMP、TIFF、TIF
  - 保持其他标签页仅支持PDF文件的拖拽功能
  - 智能文件类型检测，根据当前标签页自动过滤支持的文件格式


## [3.6.1] - 2025-09-11

### 新增

- **OCR详细日志显示**:
  - 在OCR模块界面新增实时日志显示窗口
  - 集成核心OCR模块的详细日志信息
  - 显示文件处理、API调用、转换过程等完整处理流程
  - 支持任务配置、文件分析、处理过程、结果统计等详细信息

### 优化

- **日志显示增强**:
  - 使用HTML格式化日志，支持颜色编码和样式
  - 不同日志级别使用不同颜色：信息(蓝色)、警告(橙色)、错误(红色)、核心模块(绿色)
  - 特殊格式化任务分隔线和步骤信息，提高可读性
  - 日志区域采用等宽字体和专业控制台样式
- **用户体验优化**:
  - 日志窗口自动滚动到最新内容
  - 智能日志处理器架构，避免内存泄漏
  - 增加文件大小、处理数量、API参数等详细信息显示

### 技术改进

- **日志架构重构**:
  - 创建自定义日志处理器捕获核心模块日志
  - 实现HTML格式的日志消息传递机制
  - 优化日志显示性能和内存管理
- **代码质量提升**:
  - 增强OCR工作线程的日志记录功能
  - 改进异常处理和错误信息显示
  - 统一日志格式和显示标准

## [3.6.0] - 2025-09-11

### 新增

- **OCR图片格式支持**:
  - 支持直接对图片文件进行OCR识别，无需先转换为PDF
  - 支持的图片格式：JPG、JPEG、PNG、BMP、TIFF、TIF
  - 兼容OpenAI兼容模式和Mistral API两种识别引擎
  - 智能文件类型检测，自动选择最佳处理方式
- **图片转PDF功能**:
  - 新增图片转PDF转换工具，支持Mistral API对图片的处理需求
  - 使用PyMuPDF实现高质量的图片到PDF转换
  - 保持原始图片尺寸和质量
- **文件选择器增强**:
  - OCR模块文件选择器支持PDF和图片文件混合选择
  - 提供分类文件过滤器：所有支持的文件、PDF文件、图片文件
  - 更新界面提示文本以反映支持的文件类型

### 优化

- **OCR处理流程优化**:
  - 智能识别文件类型，根据API提供商选择最佳处理策略
  - OpenAI兼容模式：PDF转图片处理，图片直接处理
  - Mistral API模式：PDF直接处理，图片转PDF后处理
  - 改进错误处理和用户反馈信息
- **代码架构改进**:
  - 增强文件类型检测功能
  - 优化临时文件管理
  - 统一API调用接口

### 修复

- **图片转PDF功能修复**:
  - 修复PyMuPDF API使用错误导致的转换失败问题
  - 使用正确的PDF创建和图片插入方法
  - 改进异常处理和错误信息提示

### 技术改进

- **依赖管理**:
  - 充分利用现有PyMuPDF依赖实现图片转PDF功能
  - 优化模块导入和函数导出结构
- **用户体验**:
  - 提供详细的处理进度日志
  - 智能处理不同文件类型，对用户透明
  - 支持常见的所有图片格式，提升易用性

## [3.5.5] - 2025-09-11

### 新增

- **OCR实时日志显示**:
  - 在OCR界面添加了专用的日志显示窗口，实时显示OCR处理过程
  - 日志窗口位于结果显示区域右侧，提供详细的操作步骤和状态信息
  - 支持时间戳显示，便于跟踪处理进度

### 优化

- **OCR界面布局重构**:
  - 重新设计OCR界面布局，使用分割器控制文件表格和结果显示区域的高度比例
  - 文件表格区域占30%高度，结果显示区域占70%高度
  - OCR结果和日志窗口左右均分，各占50%宽度
  - 界面布局更加合理，提升用户体验
- **代码结构优化**:
  - 全面清理开发过程中的废弃代码和注释
  - 统一代码风格和命名规范，提升代码可维护性
  - 优化导入语句，移除未使用的依赖
  - 重构日志处理逻辑，使用更高效的信号槽机制
- **性能提升**:
  - 优化日志显示性能，确保UI在大量日志输出时保持响应
  - 改进异常处理机制，增强程序稳定性

### 修复

- **日志功能重构**:
  - 移除了文件日志生成功能，避免生成不必要的日志文件
  - 保留控制台日志功能，同时新增UI日志显示
  - 修复了日志处理中的潜在线程安全问题

### 技术改进

- **代码一致性提升**:
  - 统一注释语言为中文，提高代码可读性
  - 规范化变量和函数命名
  - 标准化代码格式和缩进
  - 优化导入语句排序和分组
- **架构优化**:
  - 提取UI布局常量，减少魔法数字的使用
  - 改进异常处理逻辑
  - 优化文档字符串格式

## [3.5.0] - 2025-08-26

### 新增

- **OCR逐页保存功能**:
  - 支持将PDF的每一页识别结果单独保存为Markdown和Word文件
  - 文件名格式为 `[文件名][P页码].md` 和 `[文件名][P页码].docx`
  - 文件保存在PDF所在目录的 `[文件名]_md/` 和 `[文件名]_word/` 子目录中
- **OCR合并文件功能**:
  - 在逐页保存的基础上，自动生成合并所有页面的完整Markdown和Word文件
  - 合并文件命名为 `[文件名][完整合并].md` 和 `[文件名][完整合并].docx`
  - 合并文件直接保存在PDF文件所在目录
- **多模式支持**:
  - 逐页保存功能同时支持OpenAI-Compatible模式和Mistral API模式

### 修复

- **路径问题**: 修复了逐页保存目录被创建在临时文件夹而非PDF所在目录的问题
- **兼容性问题**: 修复了OpenAI-Compatible模式下pdf_path为None导致逐页保存失效的问题

## [3.4.5] - 2025-08-19

### 优化

- **OCR重试机制**: 改进了OCR识别的重试逻辑，当API返回内容为空时会自动重试，重试限制为三次，提高了OCR识别的稳定性和准确性。

## [3.4.2] - 2025-08-06

### 新增

- **OCR 文件名**: OCR 识别后生成的 Markdown 和 Word 文件名中加入了所使用的 API 模型和生成时间。

## [3.4.1] - 2025-08-06

### 优化

- **OCR转换**: 在将Markdown转换为Word文档时，启用Pandoc的`hard_line_breaks`扩展，确保Markdown中的软换行能够被正确地转换成Word中的换行。

## [3.4.0] - 2025-07-28

### 新增

- **OCR温度参数控制**: 在OCR配置中添加了温度参数设置，用户可以通过滑块控件调节AI模型的输出随机性（范围0.0-2.0，默认值1.0）。
- **OpenAI兼容模型支持**: 温度参数仅在OpenAI兼容模式下显示，Mistral API模式下自动隐藏该设置。

## [3.3.0] - 2025-07-26

### 新增

- **OCR预览功能**: 实现了OCR识别过程中每页完成后的实时预览功能，用户可以即时查看识别结果。

### 修复

- **OCR属性错误**: 修复了 `core/ocr.py` 中的 `AttributeError: 'list' object has no attribute 'get'` 错误。

### 优化

- **OCR预览显示**: 修改了OCR预览功能，使其只显示当前页的内容，而不是累积显示所有页面的内容，提高了预览的准确性。
- **OCR界面优化**: 删除了OCR标签页中冗余的"保存结果"按钮及其相关的代码，因为OCR结果现在会自动保存为.md和.docx文件，简化了用户操作。

## [3.2.2] - 2025-07-25

### 修复

- **OCR公式转换**:
    - 解决了AI模型将LaTeX公式错误地放入代码块中，导致Pandoc无法正确转换为DOCX的问题。
    - 通过**优化AI提示词**和**增加代码预处理**的双重保障机制，确保了公式转换的健壮性。
- **依赖导入**:
    - 修复了因新函数未在 `core/__init__.py` 中导出而导致的 `ImportError`。

### 优化

- **用户体验**:
    - 在OCR状态栏中增加了对当前所调用AI模型的明确显示，提升了界面的透明度。

## [2.7.3] - 2025-06-25

### 新增

- **文件列表功能增强**:
    - 新增"移至顶部"和"移至底部"快捷命令
    - 支持多选文件的批量移动
    - 改进了文件列表的拖拽排序功能

### 修复

- **文件列表操作修复**:
    - 修复了"打开所在文件夹"功能不正常的问题
    - 修复了"下移"功能在特定情况下的错误
    - 修复了多选文件移动时的位置计算问题

### 变更

- **依赖管理更新**:
    - 从 pip 切换到 uv 进行依赖管理
    - 更新了安装和运行说明文档

## [2.7.0] - 2025-06-24

### 新增

- **PDF 书签功能**: 
    - 支持为 PDF 文件添加书签
    - 支持批量添加书签
    - 支持为多个文件使用相同的书签配置
    - 支持书签配置的导入导出
    - 支持书签的编辑和预览

### 优化

- **书签功能**:
    - 优化了书签的添加逻辑，确保正确跳转
    - 改进了书签的存储和读取机制
    - 添加了书签编辑界面的用户提示

## [2.6.0] - 2025-06-23

### 新增

- **PDF 分割功能**: 用户现在可以将一个多页的 PDF 文件按页分割成多个独立的 PDF 文件。
- **PDF 转图片功能**: 新增 PDF 转图片功能，支持将 PDF 的每一页转换为 JPG 或 PNG 格式，并可以自定义分辨率 (DPI)。
- **UI 增强**:
    - 主界面更新为标签页导航，分别对应优化、合并、分割、转图片和转曲五大功能。
    - 为所有功能模块添加了文件拖放支持。

### 变更

- **README 更新**: 同步更新了 `README.md` 和 `readme_cn.md` 文件，加入了新功能的介绍和使用说明。
- **技术栈更新**: 在文档中加入了 `PyMuPDF` 作为新的项目依赖。

## [1.0.0] - 2025-06-21

### 新增

- **PDF 优化**:
    - 支持三种优化级别（低、中、高）。
    - 提供 `Pikepdf` 和 `Ghostscript` 两种优化引擎。
- **PDF 合并**:
    - 支持合并多个 PDF 文件。
    - 可通过拖拽调整文件合并顺序。
    - 提供 `Pikepdf` 和 `Ghostscript` 两种合并引擎。
- **PDF 转曲**:
    - 使用 `Ghostscript` 将 PDF 中的字体轮廓化，以保证跨设备显示效果一致。
- **图形用户界面**:
    - 基于 `PySide6` 的初始用户界面。
    - 支持文件选择和拖放。
    - 提供进度显示和结果反馈。