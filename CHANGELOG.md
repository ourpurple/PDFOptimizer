# 更新日志

## [4.0.0] - 2025-07-26 (内部重构版本)

这是一个重大的内部重构版本，专注于提升代码质量、可维护性和性能，为未来的功能迭代奠定坚实的基础。大部分更改体现在代码结构上，而非直接的用户功能。

### 新增

- **OCR 功能**: 新增了强大的 OCR 功能，支持通过 OpenAI-Compatible API 和 Mistral API 对 PDF 文件进行文字识别。
- **性能分析**: 在 OCR 标签页中添加了启用性能分析的选项，允许开发者和高级用户将 `cProfile` 的分析结果输出到日志文件中，以便于识别性能瓶颈。

### 变更

- **架构重构**:
    - **UI 解耦**: 将原先庞大的 `MainWindow` 彻底拆分，每个功能（优化、合并、OCR等）的 UI 和逻辑被封装到独立的 `QWidget` 子类中，大幅降低了代码的耦合度。
    - **逻辑抽象**: 引入了 `BaseTabWidget` 基类，抽象了文件列表、控制按钮等通用 UI 组件和逻辑，简化了新功能标签页的开发。
    - **线程统一**: 将原先多个针对特定任务的 `Worker` 线程（如 `OptimizeWorker`, `CurvesWorker`）重构为一个通用的 `ProcessingWorker`，该 Worker 可以接受任何函数作为处理任务，极大地减少了冗余的线程代码。
- **代码质量**:
    - 全面推行 `Flake8`, `Black`, `isort`, `mypy` 等静态分析和格式化工具，并对整个代码库进行了标准化处理。
    - 将代码中大部分硬编码的字符串和配置项外化到 `constants.py` 模块中，增强了可维护性。
- **依赖管理**:
    - `pyproject.toml` 现在是项目依赖的唯一事实来源。
    - `requirements.txt` 将与 `pyproject.toml` 保持同步，以确保环境的一致性。

### 优化

- **资源管理**: 全面审查了文件 I/O 和外部进程（如 Ghostscript, Pandoc）的调用，通过使用 `with` 语句和 `try...finally` 块，确保文件句柄和进程资源在操作完成或异常发生时都能被正确释放。
- **UI 响应性**: 修复了在添加文件或导入/导出配置时可能发生的 UI 阻塞问题，确保所有耗时的 I/O 操作都在后台线程中执行。
## [3.3.0] - 2025-07-26

### 新增

- **OCR预览功能**: 实现了OCR识别过程中每页完成后的实时预览功能，用户可以即时查看识别结果。

### 修复

- **OCR属性错误**: 修复了 `core/ocr.py` 中的 `AttributeError: 'list' object has no attribute 'get'` 错误。

### 优化

- **OCR预览显示**: 修改了OCR预览功能，使其只显示当前页的内容，而不是累积显示所有页面的内容，提高了预览的准确性。
- **OCR界面优化**: 删除了OCR标签页中冗余的"保存结果"按钮及其相关的代码，因为OCR结果现在会自动保存为.md和.docx文件，简化了用户操作。

## [3.2.2] - 2025-07-25

### 修复

- **OCR公式转换**:
    - 解决了AI模型将LaTeX公式错误地放入代码块中，导致Pandoc无法正确转换为DOCX的问题。
    - 通过**优化AI提示词**和**增加代码预处理**的双重保障机制，确保了公式转换的健壮性。
- **依赖导入**:
    - 修复了因新函数未在 `core/__init__.py` 中导出而导致的 `ImportError`。

### 优化

- **用户体验**:
    - 在OCR状态栏中增加了对当前所调用AI模型的明确显示，提升了界面的透明度。

## [2.7.3] - 2025-06-25

### 新增

- **文件列表功能增强**:
    - 新增"移至顶部"和"移至底部"快捷命令
    - 支持多选文件的批量移动
    - 改进了文件列表的拖拽排序功能

### 修复

- **文件列表操作修复**:
    - 修复了"打开所在文件夹"功能不正常的问题
    - 修复了"下移"功能在特定情况下的错误
    - 修复了多选文件移动时的位置计算问题

### 变更

- **依赖管理更新**:
    - 从 pip 切换到 uv 进行依赖管理
    - 更新了安装和运行说明文档

## [2.7.0] - 2025-06-24

### 新增

- **PDF 书签功能**: 
    - 支持为 PDF 文件添加书签
    - 支持批量添加书签
    - 支持为多个文件使用相同的书签配置
    - 支持书签配置的导入导出
    - 支持书签的编辑和预览

### 优化

- **书签功能**:
    - 优化了书签的添加逻辑，确保正确跳转
    - 改进了书签的存储和读取机制
    - 添加了书签编辑界面的用户提示

## [2.6.0] - 2025-06-23

### 新增

- **PDF 分割功能**: 用户现在可以将一个多页的 PDF 文件按页分割成多个独立的 PDF 文件。
- **PDF 转图片功能**: 新增 PDF 转图片功能，支持将 PDF 的每一页转换为 JPG 或 PNG 格式，并可以自定义分辨率 (DPI)。
- **UI 增强**:
    - 主界面更新为标签页导航，分别对应优化、合并、分割、转图片和转曲五大功能。
    - 为所有功能模块添加了文件拖放支持。

### 变更

- **README 更新**: 同步更新了 `README.md` 和 `readme_cn.md` 文件，加入了新功能的介绍和使用说明。
- **技术栈更新**: 在文档中加入了 `PyMuPDF` 作为新的项目依赖。

## [1.0.0] - 2025-06-21

### 新增

- **PDF 优化**:
    - 支持三种优化级别（低、中、高）。
    - 提供 `Pikepdf` 和 `Ghostscript` 两种优化引擎。
- **PDF 合并**:
    - 支持合并多个 PDF 文件。
    - 可通过拖拽调整文件合并顺序。
    - 提供 `Pikepdf` 和 `Ghostscript` 两种合并引擎。
- **PDF 转曲**:
    - 使用 `Ghostscript` 将 PDF 中的字体轮廓化，以保证跨设备显示效果一致。
- **图形用户界面**:
    - 基于 `PySide6` 的初始用户界面。
    - 支持文件选择和拖放。
    - 提供进度显示和结果反馈。